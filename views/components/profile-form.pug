form(action=formAction method="POST" enctype="multipart/form-data" class="space-y-4 max-w-xl mx-auto text-left")
  +csrfField()
  input(type="hidden", name="timezone", id="timezone")

  // Email & Confirm Email
  .grid.grid-cols-2.gap-4
    .flex.flex-col
      label(for="email" class="font-semibold") Email
      input(type="email", name="email", id="email", value=formData.email || '', class="border border-gray-300 px-3 py-2 rounded")
    .flex.flex-col
      label(for="confirmEmail" class="font-semibold") Confirm Email
      input(type="email", name="confirmEmail", id="confirmEmail", value=formData.confirmEmail || '', class="border border-gray-300 px-3 py-2 rounded")

  // Password & Confirm Password
  .grid.grid-cols-2.gap-4
    .flex.flex-col
      label(for="password" class="font-semibold") Password
      input(type="password", name="password", id="password", class="border border-gray-300 px-3 py-2 rounded")
    .flex.flex-col
      label(for="confirmPassword" class="font-semibold") Confirm Password
      input(type="password", name="confirmPassword", id="confirmPassword", class="border border-gray-300 px-3 py-2 rounded")

  // Conditionally show current password if editing
  if formMode === 'edit'
    .flex.flex-col
      label(for="currentPassword" class="font-semibold") Current Password
      input(type="password", name="currentPassword", id="currentPassword", class="border border-gray-300 px-3 py-2 rounded", placeholder="Required if changing email or password")

  // Name
  .grid.grid-cols-2.gap-4
    .flex.flex-col
      label(for="firstName" class="font-semibold") First Name
      input(type="text", name="firstName", id="firstName", value=formData.firstName || '', class="border border-gray-300 px-3 py-2 rounded")
    .flex.flex-col
      label(for="lastName" class="font-semibold") Last Name
      input(type="text", name="lastName", id="lastName", value=formData.lastName || '', class="border border-gray-300 px-3 py-2 rounded")

  // Username
  label(for="username" class="font-semibold") Username
  input(type="text", name="username", id="username", value=formData.username || '', class="w-full border border-gray-300 px-3 py-2 rounded")

  hr(class="my-4")

  // Optional Martial Arts Info
  label(for="style" class="font-semibold") Art Style (optional)
  input(type="text", name="style", id="style", value=formData.style || '', class="w-full border border-gray-300 px-3 py-2 rounded")

  .form-group
    label(for="rank") Belt Rank
    select#rank(name="rank" required class="w-full border border-gray-300 rounded-lg px-3 py-2")
      option(
        value=""
        disabled
        selected=!user || !user.rank
      ) — Select a rank —
      each r in ranks
        option(
          value=r
          selected=(user && String(r) === String(user.rank))
        )= r

  label(for="rankDetails" class="font-semibold mt-4 block") Rank Details (optional)
    input#rankDetails(
      type="text"
      name="rankDetails"
      value=formData.rankDetails || (user && user.rankDetails) || ''
      placeholder="e.g. 2nd Dan, 3 stripes, under Prof. John Doe, etc."
      class="w-full border border-gray-300 px-3 py-2 rounded mt-1"
    )

  // Avatar Upload
  label(for="avatar" class="font-semibold") Upload Avatar (optional)
  input(type="file", name="avatar", id="avatar", accept=".jpg,.jpeg,.png", class="w-full border border-gray-300 px-3 py-2 rounded file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-red-800 file:text-white hover:file:bg-red-700")

  // Submit
  button(type="submit", class="bg-red-800 hover:bg-red-700 text-white font-bold py-2 px-4 rounded shadow transition w-full") #{submitLabel}
