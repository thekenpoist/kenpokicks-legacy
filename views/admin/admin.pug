//- views/admin/console.pug (or views/admin/admin.pug if you kept that name)
extends ../layouts/admin-layout.pug

block content
  // Welcome line
  p(class="text-sm text-gray-500 mb-6")
    | Welcome, #{currentUser && (currentUser.fullName || currentUser.username)}

  // Counters (Users, Instructors, Admins)
  div(class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8")
    .bg-white.rounded-lg.shadow.p-4.border.border-gray-100
      p(class="text-xs uppercase tracking-wide text-gray-500") Users
      p(class="text-2xl font-bold text-gray-900 mt-1") #{stats && stats.studentCount || 0}
    .bg-white.rounded-lg.shadow.p-4.border.border-gray-100
      p(class="text-xs uppercase tracking-wide text-gray-500") Instructors
      p(class="text-2xl font-bold text-gray-900 mt-1") #{stats && stats.instructorCount || 0}
    .bg-white.rounded-lg.shadow.p-4.border.border-gray-100
      p(class="text-xs uppercase tracking-wide text-gray-500") Admins
      p(class="text-2xl font-bold text-gray-900 mt-1") #{stats && stats.adminCount || 0}

  // Quick actions (Manage Users, Manage Curriculum, Manage Techniques)
  div(class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6")
    a(href="/admin/all", class="block bg-white rounded-xl shadow p-5 border border-gray-100 hover:shadow-md transition")
      h3(class="text-lg font-semibold text-gray-900") Manage Users
      p(class="text-sm text-gray-600 mt-1") Create, edit, suspend, delete, and manage user and roles.
    a(href="/admin/curriculum", class="block bg-white rounded-xl shadow p-5 border border-gray-100 hover:shadow-md transition")
      h3(class="text-lg font-semibold text-gray-900") Manage Forms, Sets, Basics
      p(class="text-sm text-gray-600 mt-1") View, edit, and publish forms, sets, and basics.
    a(href="/techniques/all", class="block bg-white rounded-xl shadow p-5 border border-gray-100 hover:shadow-md transition")
      h3(class="text-lg font-semibold text-gray-900") Manage Techniques
      p(class="text-sm text-gray-600 mt-1") View, edit, and publish techniques.

  // Recent activity
  .mt-8.bg-white.rounded-xl.shadow.border.border-gray-100
    .p-5.border-b.border-gray-100.flex.items-center.justify-between
      h3(class="text-lg font-semibold text-gray-900") Recent Activity
      a(href="/admin/logs" class="text-sm text-blue-600 hover:underline") View all
    // Header row (same look as Training Diary’s headers)
    .grid.grid-cols-4.font-semibold.text-gray-600.border-b.border-gray-300.pb-2.mb-2.text-sm.px-5
      div Date
      div Action
      div Entity Label
      div Actor

    // Entries container — hydrated via fetch
    #admin-recent-activity.px-5
      .p-4.text-sm.text-gray-500 Loading…

  // New Accounts
  .mt-8.bg-white.rounded-xl.shadow.border.border-gray-100
    .p-5.border-b.border-gray-100.flex.items-center.justify-between
      h3(class="text-lg font-semibold text-gray-900") New Accounts
      a(href="/admin/users", class="text-sm text-blue-600 hover:underline") View all
    if newAccounts && newAccounts.length
      ul.divide-y.divide-gray-100
        each u in newAccounts
          li.p-4.flex.items-center.justify-between
            .min-w-0
              p(class="text-sm font-medium text-gray-900 truncate") #{u.username}
              p(class="text-xs text-gray-500 truncate") #{u.email}
            span(class="text-xs text-gray-500 ml-4 whitespace-nowrap")
              | #{u.createdAtFormatted || u.createdAt}
    else
      .p-4.text-sm.text-gray-500 No new accounts yet.

block pageScripts
  script(src="/js/features/adminConsole.js" defer)

