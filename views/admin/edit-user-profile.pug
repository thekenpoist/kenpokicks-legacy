//- views/admin/edit-user-profile.pug
extends ../layouts/admin-layout.pug

block content
  .flex.items-center.justify-between.mb-6
    a(href="/admin/all", class="text-blue-600 hover:underline") ← Back to Users
    h1(class="text-xl font-semibold")= pageTitle

  //- Main card
  .bg-white.shadow-lg.rounded-xl.p-6
    if errorMessage
      .mb-4.text-red-600.text-sm= errorMessage
    include ../mixins/csrf
    form(method="POST", action=formAction, novalidate)
      +csrfField()
      .space-y-4
        .grid.grid-cols-1.gap-4
          .form-group
            label.block.text-sm.font-medium.mb-1(for="username") Username
            input#username(type="text", name="username", required, value=formData.username, class="w-full border border-gray-300 rounded-lg px-3 py-2")

          .form-group
            label.block.text-sm.font-medium.mb-1(for="firstName") First Name
            input#firstName(type="text", name="firstName", required, value=formData.firstName, class="w-full border border-gray-300 rounded-lg px-3 py-2")

          .form-group
            label.block.text-sm.font-medium.mb-1(for="lastName") Last Name
            input#lastName(type="text", name="lastName", required, value=formData.lastName, class="w-full border border-gray-300 rounded-lg px-3 py-2")

          .form-group
            label.block.text-sm.font-medium.mb-1(for="email") Email
            input#email(type="email", name="email", required, value=formData.email, class="w-full border border-gray-300 rounded-lg px-3 py-2")

          .form-group
            label.block.text-sm.font-medium.mb-1(for="confirmEmail") Confirm Email
            input#confirmEmail(type="email", name="confirmEmail", required, value=formData.confirmEmail, class="w-full border border-gray-300 rounded-lg px-3 py-2")

          .form-group
            label.block.text-sm.font-medium.mb-1(for="role") Role
            select#role(name="role", required, class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white" disabled=!canChangeRole)
              option(value="", disabled, selected=!formData || !formData.role) — Select a role —
              if roles && roles.length
                each r in roles
                  option(value=r, selected=String(r) === String(formData.role))= r

          .form-group
            label.block.text-sm.font-medium.mb-1(for="style") Style
            input#style(type="text", name="style", value=formData.style, class="w-full border border-gray-300 rounded-lg px-3 py-2")

          .form-group
            label(for="rank") Belt Rank
            select#rank(name="rank" required class="w-full border border-gray-300 rounded-lg px-3 py-2")
              option(
                value=""
                disabled
                selected=!user || !user.rank
              ) — Select a rank —
              each r in ranks
                option(
                  value=r
                  selected=(user && String(r) === String(user.rank))
                )= r



          .form-group
            label.block.text-sm.font-medium.mb-1(for="timezone") Timezone
            input#timezone(type="text", name="timezone", value=formData.timezone, placeholder="America/Los_Angeles", class="w-full border border-gray-300 rounded-lg px-3 py-2")

      .mt-4
        button(type="submit", class="inline-flex items-center px-4 py-2 rounded-lg bg-blue-600 text-white")= submitLabel

  //- Account controls card
  .bg-white.shadow-lg.rounded-xl.p-6.mt-6
    h2(class="text-lg font-semibold mb-4") Account Controls

    hr(class="my-4")

    //- Suspend user
    form(method="POST", action=(formAction && formAction.replace('/update','/suspend')))
      +csrfField()
      .flex.items-center.justify-between.gap-3
        span(class="text-sm") Prevent login until reactivated
        button(type="submit", class="px-3 py-2 rounded-lg bg-yellow-300") Suspend User

    hr(class="my-4")

    //- Deactivate or Delete user
    form(method="POST", action=(formAction && formAction.replace('/update','/deactivate')))
      +csrfField()
      .flex.items-center.justify-between.gap-3
        span(class="text-sm") Proceed to deactivate or delete on the next step
        button(
          type="submit",
          class="px-3 py-2 rounded-lg bg-red-500 text-white",
          onclick='return confirm("Proceed with account removal")'
        ) Deactivate or Delete User
