include ../mixins/csrf
doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    meta(name="csrf-token" content=csrfToken)
    script.window.CSRF_TOKEN = '!{csrfToken}'
    title #{pageTitle}
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css")

    style.
      @font-face {
        font-family: "Karate";
        src: url("/fonts/Karate.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
      }

      body {
        font-family: "Lora", serif;
      }

      .kenpo-font {
        font-family: "Karate", sans-serif;
      }

  body(class="bg-gray-100 flex")

    // Flash Messages (offset so they don't sit under the fixed sidebar)
    if typeof messages !== 'undefined' && (messages.info || messages.success || messages.error)
      .fixed.top-0.left-0.right-0.z-40.px-6.pt-4.space-y-2.ml-64
        if messages.info && messages.info.length
          each msg in messages.info
            p(class="bg-blue-50 text-blue-800 px-4 py-2 rounded border border-blue-200 shadow-sm")= msg
        if messages.success && messages.success.length
          each msg in messages.success
            p(class="bg-green-50 text-green-800 px-4 py-2 rounded border border-green-200 shadow-sm")= msg
        if messages.error && messages.error.length
          each msg in messages.error
            p(class="bg-red-50 text-red-800 px-4 py-2 rounded border border-red-200 shadow-sm")= msg

    // Sidebar
    aside(class="fixed inset-y-0 left-0 w-64 bg-red-800 text-white p-6 flex flex-col space-y-6 z-20")
      img(src="/images/AMTSPatch.jpg" alt="Kenpo Kicks Logo" class="mx-auto w-full max-w-lg")
      nav.flex.flex-col.text-lg.pl-4.pr-2
        a(href="/portal/dashboard" class="hover:text-green-700 transition") Dashboard

        a(href="/logs/all" class="hover:text-green-700 transition") Training Logs

        a(href="/philosophy" class="hover:text-green-700 transition mt-6") Philosophy
        a(href="/history" class="hover:text-green-700 transition") History of Kenpo
        a(href="/faqs" class="hover:text-green-700 transition") FAQ's

        a(href="/profiles/me" class="hover:text-green-700 transition mt-6") Profile

        a(href="/" class="hover:text-green-700 transition mt-6") Home

        if currentUser && currentUser.role === 'admin' || currentUser && currentUser.role === 'superadmin'
          a(href="/admin", class="hover:text-green-700 transition mt-6") Admin


        //- Future links
        // a(href="/portal/goals" class="hover:text-green-400 transition") Goals
        // a(href="/portal/forum" class="hover:text-green-400 transition") Forum
        a(href="/auth/logout" class="hover:text-green-700 transition mt-auto text-sm") Logout

    // Main Content
    main(class="flex-1 p-10 lg:ml-64 h-screen overflow-y-auto")
      block content
      script(src="/js/app.client.js" defer)
      block pageScripts
